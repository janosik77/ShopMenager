<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:ShopMenager.ViewModels.OrderVM"
    x:Class="ShopMenager.Views.OrderV.OrderDetailView"
    Title="{Binding Title}"
    BackgroundColor="{StaticResource Primary}">

    <Grid>
        <!-- Grid dzieli stronę na dwa wiersze: przewijalny content i stały footer -->
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollView Grid.Row="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                    <Frame Grid.Row="0" BackgroundColor="{StaticResource Primary}"
                       Margin="15,0"
                       HasShadow="False"
                       CornerRadius="15">
                    <StackLayout Padding="20" Spacing="15" VerticalOptions="Start">
                        <Label Text="{Binding CustomerName}"
                               Style="{StaticResource DetailLabel}"
                               TextColor="{StaticResource SecondaryColor}"
                               HorizontalOptions="Center"
                               Margin="0,20,0,50"
                               FontSize="32"/>

                        <Grid ColumnSpacing="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="Order ID:" 
                                   Style="{StaticResource DetailLabel}"
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Start"/>
                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding OrderID}" 
                                   Style="{StaticResource DetailLabel}"
                                   TextColor="{StaticResource DetailsTextColor}"
                                   HorizontalOptions="End"/>

                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="Customer ID:" 
                                   Style="{StaticResource DetailLabel}"
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Start"/>
                            <Label Grid.Row="1" Grid.Column="1"
                                   Text="{Binding CustomerID}" 
                                   Style="{StaticResource DetailLabel}"
                                   TextColor="{StaticResource DetailsTextColor}"
                                   HorizontalOptions="End"/>

                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="Employee ID:" 
                                   Style="{StaticResource DetailLabel}"
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Start"/>
                            <Label Grid.Row="2" Grid.Column="1"
                                   Text="{Binding EmployeeID}" 
                                   Style="{StaticResource DetailLabel}"
                                   TextColor="{StaticResource DetailsTextColor}"
                                   HorizontalOptions="End"/>

                            <Label Grid.Row="3" Grid.Column="0"
                                   Text="Order Date:" 
                                   Style="{StaticResource DetailLabel}"
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Start"/>
                            <Label Grid.Row="3" Grid.Column="1"
                                   Text="{Binding OrderDate, StringFormat='{0:MM/dd/yyyy}'}" 
                                   Style="{StaticResource DetailLabel}"
                                   TextColor="{StaticResource DetailsTextColor}"
                                   HorizontalOptions="End"/>

                            <Label Grid.Row="4" Grid.Column="0"
                                   Text="Status:" 
                                   Style="{StaticResource DetailLabel}"
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Start"/>
                            <Label Grid.Row="4" Grid.Column="1"
                                   Text="{Binding Status}" 
                                   Style="{StaticResource DetailLabel}"
                                   TextColor="{StaticResource DetailsTextColor}"
                                   HorizontalOptions="End"/>

                            <Label Grid.Row="6" Grid.Column="0"
                                   Text="Employee:" 
                                   Style="{StaticResource DetailLabel}"
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Start"/>
                            <Label Grid.Row="6" Grid.Column="1"
                                   Text="{Binding EmployeeName}" 
                                   Style="{StaticResource DetailLabel}"
                                   TextColor="{StaticResource DetailsTextColor}"
                                   HorizontalOptions="End"/>
                        </Grid>

                    </StackLayout>
                </Frame>
                <StackLayout Grid.Row="1" Padding="15" Spacing="15" BackgroundColor="{StaticResource Primary}">
                    <!-- Nagłówek tabeli -->
                    <Grid ColumnSpacing="10" Padding="10" BackgroundColor="{StaticResource Clauds}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Label Text="Product Name" 
                               Style="{StaticResource DetailLabel}"
                               TextColor="{StaticResource SecondaryColor}"
                               HorizontalOptions="Start" 
                               FontSize="16"/>
                        <Label Text="Quantity" 
                               Style="{StaticResource DetailLabel}"
                               TextColor="{StaticResource SecondaryColor}"
                               HorizontalOptions="Center" Grid.Column="1" 
                               FontSize="16"/>
                        <Label Text="Discount" 
                               Style="{StaticResource DetailLabel}"
                               TextColor="{StaticResource SecondaryColor}"
                               HorizontalOptions="Center" Grid.Column="2" 
                               FontSize="16"/>
                        <Label Text="Total" 
                               Style="{StaticResource DetailLabel}"
                               TextColor="{StaticResource SecondaryColor}"
                               HorizontalOptions="Center" Grid.Column="3" 
                               FontSize="16"/>
                    </Grid>

                    <!-- Lista pozycji jako tabela -->
                    <CollectionView ItemsSource="{Binding OrderPositions}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="10" Margin="0,5" HasShadow="False" BackgroundColor="{StaticResource Clauds}">
                                    <Grid ColumnSpacing="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Label Grid.Column="0" 
                                               Text="{Binding ProductName}" 
                                               Style="{StaticResource DetailLabel}" 
                                               HorizontalOptions="Start"
                                               FontSize="14"/>
                                        <Label Grid.Column="1" 
                                               Text="{Binding Quantity}" 
                                               Style="{StaticResource DetailLabel}" 
                                               HorizontalOptions="Center"
                                               FontSize="14"/>
                                        <Label Grid.Column="2" 
                                               Text="{Binding DiscountPerc, StringFormat='{0}%'}" 
                                               Style="{StaticResource DetailLabel}" 
                                               HorizontalOptions="Center"
                                               FontSize="14"/>
                                        <Label Grid.Column="3" 
                                               Text="{Binding Total, StringFormat='{0:C}'}" 
                                               Style="{StaticResource DetailLabel}" 
                                               HorizontalOptions="Center"
                                               FontSize="14"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Grid>
        </ScrollView>

        <StackLayout Grid.Row="1" Padding="20" Spacing="15">
            <Button Text="Edit"
                    Command="{Binding EditCommand}"
                    CommandParameter="{Binding OrderID}" />
            <Button Text="Delete"
                    Command="{Binding DeleteCommand}"
                    CommandParameter="{Binding OrderID}" />
            <Button Text="Back to List"
                    Command="{Binding CancelCommand}" />
        </StackLayout>
    </Grid>
</ContentPage>
